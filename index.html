<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Etho-Track - Bilan Transition Canine</title>
    <!-- Chargement de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chargement de React et Babel pour le support JSX en ligne -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* Styles personnalis√©s pour le curseur de la barre d'excitation */
        input[type='range']::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #4f46e5;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid white;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- INLINE SVG ICONS ---
        const Icons = {
            Activity: () => (
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
            ),
            ClipboardList: () => (
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></svg>
            ),
            MapPin: () => (
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
            ),
            Save: () => (
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
            ),
            FileText: () => (
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
            ),
            Send: () => (
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
            ),
            Target: () => (
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
            ),
            Play: () => (
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
            ),
            Square: () => (
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/></svg>
            ),
            RotateCcw: () => (
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
            ),
            Camera: () => (
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>
            )
        };

        const App = () => {
            const [dogName, setDogName] = useState("Sanka");
            const [dogPhoto, setDogPhoto] = useState(null);
            const [sessions, setSessions] = useState([]);
            const [location, setLocation] = useState("Localisation...");
            const [formData, setFormData] = useState({
                date: new Date().toLocaleDateString('fr-FR'),
                environnement: 'campagne',
                typeSortie: 'travail',
                latence: '2',
                excitation: 3,
                reactionSociale: 'indifference',
                redescente: 'moyenne',
                notes: ''
            });
            const [showReport, setShowReport] = useState(false);
            const [message, setMessage] = useState(null);

            const [timer, setTimer] = useState(0);
            const [isTimerRunning, setIsTimerRunning] = useState(false);
            const timerRef = useRef(null);
            const fileInputRef = useRef(null);

            useEffect(() => {
                if ("geolocation" in navigator) {
                    navigator.geolocation.getCurrentPosition(
                        async (position) => {
                            const { latitude, longitude } = position.coords;
                            try {
                                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`);
                                const data = await response.json();
                                const city = data.address.city || data.address.town || data.address.village || "Lieu inconnu";
                                setLocation(city);
                            } catch (error) {
                                setLocation(`${latitude.toFixed(2)}, ${longitude.toFixed(2)}`);
                            }
                        },
                        () => setLocation("GPS d√©sactiv√©")
                    );
                }
            }, []);

            useEffect(() => {
                if (isTimerRunning) {
                    timerRef.current = setInterval(() => setTimer(t => t + 0.1), 100);
                } else {
                    clearInterval(timerRef.current);
                }
                return () => clearInterval(timerRef.current);
            }, [isTimerRunning]);

            const handlePhotoUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => setDogPhoto(reader.result);
                    reader.readAsDataURL(file);
                }
            };

            const handleSaveSession = () => {
                setSessions([formData, ...sessions]);
                setMessage("Session enregistr√©e !");
                setTimeout(() => setMessage(null), 3000);
                setFormData({ ...formData, notes: '', date: new Date().toLocaleDateString('fr-FR') });
                setIsTimerRunning(false);
                setTimer(0);
            };

            const calculateStats = () => {
                if (sessions.length === 0) return null;
                const avgExcitation = (sessions.reduce((acc, s) => acc + parseInt(s.excitation), 0) / sessions.length).toFixed(1);
                const focusRate = (sessions.filter(s => s.reactionSociale === 'indifference').length / sessions.length * 100).toFixed(0);
                return { avgExcitation, focusRate };
            };

            const stats = calculateStats();

            return (
                <div className="max-w-md mx-auto bg-gray-50 min-h-screen pb-10 shadow-2xl font-sans text-gray-800">
                    {message && (
                        <div className="fixed top-4 left-1/2 -translate-x-1/2 z-50 bg-green-500 text-white px-6 py-2 rounded-full shadow-lg font-bold animate-bounce">
                            {message}
                        </div>
                    )}

                    <header className="bg-gradient-to-br from-indigo-700 to-indigo-900 text-white p-6 rounded-b-[2.5rem] shadow-xl relative overflow-hidden">
                        <div className="relative z-10 flex justify-between items-start">
                            <div>
                                <h1 className="text-2xl font-bold flex items-center gap-2">
                                    <span className="text-green-400"><Icons.Activity /></span> 
                                    Etho-Track
                                </h1>
                                <p className="text-indigo-100 text-[10px] uppercase tracking-widest mt-1 font-semibold opacity-80">Transition Canine</p>
                            </div>
                            <div className="bg-white/10 px-3 py-1.5 rounded-full backdrop-blur-md border border-white/20 flex items-center gap-2 max-w-[150px]">
                                <span className="text-white/80"><Icons.MapPin /></span>
                                <span className="text-[10px] font-bold truncate">{location}</span>
                            </div>
                        </div>

                        {stats && (
                            <div className="relative z-10 flex gap-4 mt-6">
                                <div className="bg-white/10 flex-1 p-3 rounded-2xl backdrop-blur-sm border border-white/10 text-center">
                                    <p className="text-[10px] uppercase opacity-70 font-bold">Focus Ma√Ætre</p>
                                    <p className="text-2xl font-black">{stats.focusRate}%</p>
                                </div>
                                <div className="bg-white/10 flex-1 p-3 rounded-2xl backdrop-blur-sm border border-white/10 text-center">
                                    <p className="text-[10px] uppercase opacity-70 font-bold">Excitation</p>
                                    <p className="text-2xl font-black">{stats.avgExcitation}</p>
                                </div>
                            </div>
                        )}
                    </header>

                    <main className="p-4 space-y-6 -mt-4 relative z-20">
                        {/* PROFIL DU CHIEN */}
                        <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-gray-100 flex flex-col items-center gap-4">
                            <div className="relative w-32 h-32">
                                <div className="w-full h-full rounded-full overflow-hidden bg-indigo-50 border-4 border-white shadow-md flex items-center justify-center">
                                    {dogPhoto ? <img src={dogPhoto} className="w-full h-full object-cover" /> : <span className="text-4xl">üêï</span>}
                                </div>
                                <button onClick={() => fileInputRef.current.click()} className="absolute bottom-0 right-0 bg-indigo-600 text-white p-2 rounded-full shadow-lg">
                                    <Icons.Camera />
                                </button>
                                <input type="file" ref={fileInputRef} onChange={handlePhotoUpload} accept="image/*" className="hidden" />
                            </div>
                            <input type="text" value={dogName} onChange={(e) => setDogName(e.target.value)} className="text-2xl font-black text-indigo-900 border-none bg-transparent text-center focus:ring-0 w-full" />
                        </div>

                        {/* FORMULAIRE */}
                        <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-gray-100 space-y-4">
                            <h2 className="text-indigo-900 font-bold flex items-center gap-2 border-b pb-3">
                                <Icons.ClipboardList /> Saisie Terrain
                            </h2>
                            <div className="grid grid-cols-2 gap-4">
                                <div className="space-y-1">
                                    <label className="text-[10px] font-bold text-gray-400 uppercase">Milieu</label>
                                    <select name="environnement" value={formData.environnement} onChange={(e) => setFormData({...formData, environnement: e.target.value})} className="w-full p-3 bg-gray-50 rounded-2xl text-sm outline-none">
                                        <option value="campagne">üèûÔ∏è Campagne</option>
                                        <option value="ville">üèôÔ∏è Ville</option>
                                        <option value="foret">üå≤ For√™t</option>
                                        <option value="plage">üèñÔ∏è Plage</option>
                                    </select>
                                </div>
                                <div className="space-y-1">
                                    <label className="text-[10px] font-bold text-gray-400 uppercase">Activit√©</label>
                                    <select name="typeSortie" value={formData.typeSortie} onChange={(e) => setFormData({...formData, typeSortie: e.target.value})} className="w-full p-3 bg-gray-50 rounded-2xl text-sm outline-none">
                                        <option value="travail">üéØ Recherche</option>
                                        <option value="mulotage">üê≠ Mulotage</option>
                                        <option value="balade">ü¶Æ Balade</option>
                                    </select>
                                </div>
                            </div>

                            <div className="flex items-center gap-3 bg-indigo-50 p-3 rounded-2xl border border-indigo-100">
                                <div className="flex-1 text-center">
                                    <span className="text-xs font-bold text-indigo-400 block mb-1 uppercase">Timer</span>
                                    <span className="text-xl font-mono font-black">{timer.toFixed(1)}s</span>
                                </div>
                                <button onClick={() => setIsTimerRunning(!isTimerRunning)} className={`p-2 rounded-xl text-white ${isTimerRunning ? 'bg-red-500' : 'bg-indigo-600'}`}>
                                    {isTimerRunning ? <Icons.Square /> : <Icons.Play />}
                                </button>
                                <button onClick={() => {setIsTimerRunning(false); setTimer(0)}} className="p-2 bg-white text-indigo-600 rounded-xl border border-indigo-200">
                                    <Icons.RotateCcw />
                                </button>
                            </div>

                            <div className="space-y-2">
                                <label className="text-[10px] font-bold text-gray-400 uppercase flex justify-between">Excitation <span>{formData.excitation}/5</span></label>
                                <input type="range" min="1" max="5" value={formData.excitation} onChange={(e) => setFormData({...formData, excitation: e.target.value})} className="w-full h-2 bg-indigo-100 rounded-lg appearance-none accent-indigo-600"/>
                            </div>

                            <div className="space-y-1">
                                <label className="text-[10px] font-bold text-gray-400 uppercase">R√©action Sociale</label>
                                <select value={formData.reactionSociale} onChange={(e) => setFormData({...formData, reactionSociale: e.target.value})} className="w-full p-3 bg-gray-50 rounded-2xl text-sm outline-none">
                                    <option value="indifference">üòê Focus Ma√Ætre</option>
                                    <option value="vigilance">üßê Vigilance</option>
                                    <option value="tension">üêï Tension laisse</option>
                                </select>
                            </div>

                            <textarea value={formData.notes} onChange={(e) => setFormData({...formData, notes: e.target.value})} placeholder="Notes..." className="w-full p-4 bg-gray-50 rounded-2xl text-sm h-24 outline-none resize-none"></textarea>

                            <button onClick={handleSaveSession} className="w-full bg-green-500 text-white font-bold py-4 rounded-2xl shadow-lg flex items-center justify-center gap-2 active:scale-95 transition-transform">
                                <Icons.Save /> ENREGISTRER
                            </button>
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
